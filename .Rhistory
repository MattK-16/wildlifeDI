geom_vline(xintercept=days_vec[3]-0.5,col='orange') +               #Stage 1 - May 20
geom_vline(xintercept=days_vec[4]-0.5,col='#DBA800',lty=1) +        #Stage 2 - Jun 12
geom_vline(xintercept=days_vec[5]-0.5,col='#005000',lty=1) +        #Stage 3 - Jul 17
geom_vline(xintercept=days_vec[8]-7.5,col='#DBA800',lty=1) +        #Stage 2 - Oct 10
geom_vline(xintercept=days_vec[9]-0.5,col='red',lty=2) +        #Toronto Lockdown - Nov23
geom_vline(xintercept=days_vec[10]-0.5,col='red',lty=1) +        #Lockdown - Dec 26
annotate('text',x=days_vec[1]-5,y=Inf,hjust=1.1,label='Lockdown - Mar 17',angle=90,color='red',size=txtsz)+
annotate('text',x=days_vec[3]-5,y=Inf,hjust=1.1,label='Stage 1 - May 20',angle=90,color='orange',size=txtsz)+
annotate('text',x=days_vec[4]-5,y=Inf,hjust=1.1,label='Stage 2 - Jun 12',angle=90,color='#DBA800',size=txtsz)+
annotate('text',x=days_vec[5]-5,y=Inf,hjust=1.1,label='Stage 3 - Jul 17',angle=90,color='#005000',size=txtsz)+
annotate('text',x=days_vec[8]-12,y=Inf,hjust=1.1,label='Stage 2* - Oct 10',angle=90,color='#DBA800',size=txtsz)+
annotate('text',x=days_vec[9]-5,y=Inf,hjust=1.1,label='Lockdown* -  Nov 23',angle=90,color='red',size=txtsz)+
annotate('text',x=days_vec[10]-5,y=Inf,hjust=1.1,label='Lockdown - Dec 26',angle=90,color='red',size=txtsz)+
geom_ribbon(data=df_rib, mapping=aes(x=jDay,ymin=p10,ymax=p90),fill='coral',alpha=0.2) +
geom_line(data = df_mean,mapping=aes(x=jDay,y=!!column),color='black',lwd=1) +
geom_rect(data=bl_rect, aes(xmin=start,xmax=end,ymin=bottom,ymax=top),fill=NA, color='purple',alpha=0.4) +
annotate('text',x=45,y=Inf,vjust=2.5,label='Baseline',color='purple',size=txtsz) +
geom_hline(yintercept=100,color='#3F3F3f',lwd=1,lty=2) +
scale_x_continuous(breaks=c(1, 32, 61, 92, 122, 153, 183,214,245,275,306,336),
labels=c('Jan','Feb','Mar','Apr','May','Jun','Jul',
'Aug','Sep','Oct','Nov','Dec')) +
labs(y=laby,x='') +
theme_light()
if (!is.null(limy)) { gg = gg + coord_cartesian(ylim=c(0, limy))}
return(gg)
}
txtsz = 3
plot_case = ggplot() +
geom_line(data=prov_cov, aes(x=jDay,y=cases)) +
#geom_line(data=hr_cov, aes(x=jDay,y=cases,color=HRUID),color='grey') +
#geom_rect(data=rect, aes(xmin=x1,xmax=x2,ymin=y1,ymax=y2),fill=NA,color='blue',alpha=0.4)+
scale_y_continuous(breaks=c(0, 200, 400, 600, 800)) +
scale_x_continuous(breaks=c(1, 32, 61, 92, 122, 153, 183,214,245,275,306,336),
labels=c('Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec')) +
xlab('') +
ylab('Cases') +
geom_vline(xintercept=days_vec[1]-0.5,col='red') +                #Lockdown - Mar 17
geom_vline(xintercept=days_vec[3]-0.5,col='orange') +               #Stage 1 - May 20
geom_vline(xintercept=days_vec[4]-0.5,col='#DBA800',lty=1) +        #Stage 2 - Jun 12
geom_vline(xintercept=days_vec[5]-0.5,col='#005000',lty=1) +        #Stage 3 - Jul 17
geom_vline(xintercept=days_vec[8]-7.5,col='#DBA800',lty=1) +       #Stage 2 - Oct 10
geom_vline(xintercept=days_vec[9]-0.5,col='red',lty=2) +        #Toronto Lockdown - Nov23
geom_vline(xintercept=days_vec[10]-0.5,col='red',lty=1) +        #Lockdown - Dec 26
annotate('text',x=days_vec[1]-5,y=Inf,hjust=1.1,label='Lockdown - Mar 17',angle=90,color='red',size=txtsz)+
annotate('text',x=days_vec[3]-5,y=Inf,hjust=1.1,label='Stage 1 - May 20',angle=90,color='orange',size=txtsz)+
annotate('text',x=days_vec[4]-5,y=Inf,hjust=1.1,label='Stage 2 - Jun 12',angle=90,color='#DBA800',size=txtsz)+
annotate('text',x=days_vec[5]-5,y=Inf,hjust=1.1,label='Stage 3 - Jul 17',angle=90,color='#005000',size=txtsz)+
annotate('text',x=days_vec[8]-12,y=Inf,hjust=1.1,label='Stage 2* - Oct 10',angle=90,color='#DBA800',size=txtsz) +
annotate('text',x=days_vec[9]-5,y=Inf,hjust=1.1,label='Lockdown* - Nov 23',angle=90,color='red',size=txtsz)+
annotate('text',x=days_vec[10]-5,y=Inf,hjust=1.1,label='Lockdown - Dec 26',angle=90,color='red',size=txtsz)+
theme_light()
plot_case
gg5 = ts_plot(df_bl,stat='bl_avg_h_RoG',laby='RoG',limy=400)
gg6 = ts_plot(df_bl,stat='bl_avg_TotalDur',laby='TOH',limy=200)
gg7 = ts_plot(df_bl,stat='bl_avg_d_shannon',laby='DIV',limy=150)
gg5 = gg5 + labs(tag='b)')
gg6 = gg6 + labs(tag='c)')
gg7 = gg7 + labs(tag='d)')
plot_case = plot_case + labs(tag='a)')
plot = grid.arrange(plot_case, gg5,gg6,gg7,nrow=4)
ggsave(plot,file='Fig 1 - TSPlot.png',width=8,height=10)
txtsz = 3
plot_case = ggplot() +
geom_line(data=prov_cov, aes(x=jDay,y=cases)) +
#geom_line(data=hr_cov, aes(x=jDay,y=cases,color=HRUID),color='grey') +
#geom_rect(data=rect, aes(xmin=x1,xmax=x2,ymin=y1,ymax=y2),fill=NA,color='blue',alpha=0.4)+
#scale_y_continuous(breaks=c(0, 200, 400, 600, 800)) +
scale_x_continuous(breaks=c(1, 32, 61, 92, 122, 153, 183,214,245,275,306,336),
labels=c('Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec')) +
xlab('') +
ylab('Cases') +
geom_vline(xintercept=days_vec[1]-0.5,col='red') +                #Lockdown - Mar 17
geom_vline(xintercept=days_vec[3]-0.5,col='orange') +               #Stage 1 - May 20
geom_vline(xintercept=days_vec[4]-0.5,col='#DBA800',lty=1) +        #Stage 2 - Jun 12
geom_vline(xintercept=days_vec[5]-0.5,col='#005000',lty=1) +        #Stage 3 - Jul 17
geom_vline(xintercept=days_vec[8]-7.5,col='#DBA800',lty=1) +       #Stage 2 - Oct 10
geom_vline(xintercept=days_vec[9]-0.5,col='red',lty=2) +        #Toronto Lockdown - Nov23
geom_vline(xintercept=days_vec[10]-0.5,col='red',lty=1) +        #Lockdown - Dec 26
annotate('text',x=days_vec[1]-5,y=Inf,hjust=1.1,label='Lockdown - Mar 17',angle=90,color='red',size=txtsz)+
annotate('text',x=days_vec[3]-5,y=Inf,hjust=1.1,label='Stage 1 - May 20',angle=90,color='orange',size=txtsz)+
annotate('text',x=days_vec[4]-5,y=Inf,hjust=1.1,label='Stage 2 - Jun 12',angle=90,color='#DBA800',size=txtsz)+
annotate('text',x=days_vec[5]-5,y=Inf,hjust=1.1,label='Stage 3 - Jul 17',angle=90,color='#005000',size=txtsz)+
annotate('text',x=days_vec[8]-12,y=Inf,hjust=1.1,label='Stage 2* - Oct 10',angle=90,color='#DBA800',size=txtsz) +
annotate('text',x=days_vec[9]-5,y=Inf,hjust=1.1,label='Lockdown* - Nov 23',angle=90,color='red',size=txtsz)+
annotate('text',x=days_vec[10]-5,y=Inf,hjust=1.1,label='Lockdown - Dec 26',angle=90,color='red',size=txtsz)+
theme_light()
plot_case
txtsz = 3
plot_case = ggplot() +
geom_line(data=prov_cov, aes(x=jDay,y=cases)) +
#geom_line(data=hr_cov, aes(x=jDay,y=cases,color=HRUID),color='grey') +
#geom_rect(data=rect, aes(xmin=x1,xmax=x2,ymin=y1,ymax=y2),fill=NA,color='blue',alpha=0.4)+
#scale_y_continuous(breaks=c(0, 200, 400, 600, 800)) +
scale_x_continuous(breaks=c(1, 32, 61, 92, 122, 153, 183,214,245,275,306,336),
labels=c('Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec')) +
xlab('') +
ylab('Daily New Cases') +
geom_vline(xintercept=days_vec[1]-0.5,col='red') +                #Lockdown - Mar 17
geom_vline(xintercept=days_vec[3]-0.5,col='orange') +               #Stage 1 - May 20
geom_vline(xintercept=days_vec[4]-0.5,col='#DBA800',lty=1) +        #Stage 2 - Jun 12
geom_vline(xintercept=days_vec[5]-0.5,col='#005000',lty=1) +        #Stage 3 - Jul 17
geom_vline(xintercept=days_vec[8]-7.5,col='#DBA800',lty=1) +       #Stage 2 - Oct 10
geom_vline(xintercept=days_vec[9]-0.5,col='red',lty=2) +        #Toronto Lockdown - Nov23
geom_vline(xintercept=days_vec[10]-0.5,col='red',lty=1) +        #Lockdown - Dec 26
annotate('text',x=days_vec[1]-5,y=Inf,hjust=1.1,label='Lockdown - Mar 17',angle=90,color='red',size=txtsz)+
annotate('text',x=days_vec[3]-5,y=Inf,hjust=1.1,label='Stage 1 - May 20',angle=90,color='orange',size=txtsz)+
annotate('text',x=days_vec[4]-5,y=Inf,hjust=1.1,label='Stage 2 - Jun 12',angle=90,color='#DBA800',size=txtsz)+
annotate('text',x=days_vec[5]-5,y=Inf,hjust=1.1,label='Stage 3 - Jul 17',angle=90,color='#005000',size=txtsz)+
annotate('text',x=days_vec[8]-12,y=Inf,hjust=1.1,label='Stage 2* - Oct 10',angle=90,color='#DBA800',size=txtsz) +
annotate('text',x=days_vec[9]-5,y=Inf,hjust=1.1,label='Lockdown* - Nov 23',angle=90,color='red',size=txtsz)+
annotate('text',x=days_vec[10]-5,y=Inf,hjust=1.1,label='Lockdown - Dec 26',angle=90,color='red',size=txtsz)+
theme_light()
plot_case
gg5 = ts_plot(df_bl,stat='bl_avg_h_RoG',laby='RoG',limy=400)
gg6 = ts_plot(df_bl,stat='bl_avg_TotalDur',laby='TOH',limy=200)
gg7 = ts_plot(df_bl,stat='bl_avg_d_shannon',laby='DIV',limy=150)
gg5 = gg5 + labs(tag='b)')
gg6 = gg6 + labs(tag='c)')
gg7 = gg7 + labs(tag='d)')
plot_case = plot_case + labs(tag='a)')
plot = grid.arrange(plot_case, gg5,gg6,gg7,nrow=4)
ggsave(plot,file='Fig 1 - TSPlot.png',width=8,height=10)
library(ggplot2)
library(dplyr)
library(sf)
library(gridExtra)
library(reshape2)
library(tidyverse)
df = read.csv('D:/COVID_19/Data/ADA_Mobility_2020_01_12.csv')
length(unique(df$ADAUID))
df = df[df$n_RoG > 99,]
nmax = max(df$jDay)
df_count = df %>%
group_by(ADAUID) %>%
summarise(n = n()) %>%
as.data.frame()
ada_keep = df_count$ADAUID[which(df_count$n == nmax)]
df = df[df$ADAUID %in% ada_keep,]
length(unique(df$ADAUID))
nday = max(df$jDay)
df3 = df[order(df$ADAUID,df$jDay),]
#January 1 is a wednesday
df3$DoW = factor(rep(c('We','Th','Fr','Sa','Su','Mo','Tu'),length=nday))
#February data
bl_rec = subset(df3, jDay > 31 & jDay < 61) %>%
group_by(ADAUID,DoW) %>%
select(ADAUID,DoW,avg_h_RoG,avg_TotalDur,avg_d_shannon) %>%
summarise_all(mean)
df_bl <- left_join(df3, bl_rec,by = c('ADAUID', 'DoW'))
df_bl$bl_avg_h_RoG = df_bl$avg_h_RoG.x/df_bl$avg_h_RoG.y * 100
df_bl$bl_avg_TotalDur = df_bl$avg_TotalDur.x/df_bl$avg_TotalDur.y * 100
df_bl$bl_avg_d_shannon = df_bl$avg_d_shannon.x/df_bl$avg_d_shannon.y * 100
df_bl = df_bl[,c('ADAUID','jDay','bl_avg_h_RoG','bl_avg_TotalDur','bl_avg_d_shannon')]
#write.csv(df_bl,file='D:/COVID_19/Data/ForDashboard_Jan-Oct.csv')
da_poly = st_read('D:/data/Canada/census/lda_000a16a_e.shp')
da = st_drop_geometry(da_poly)
da$DAUID = as.numeric(da$DAUID)
imd = read.csv('D:/COVID_19/Data/on_scores_quintiles-eng/on_scores_quintiles_EN.csv')
imd = left_join(imd,da[,c('DAUID','ADAUID')],by=c('PRCDDA'='DAUID'))
imd = imd %>%
group_by(ADAUID) %>%
summarise(
pop = sum(Dissemination.area..DA..Population),
RI = weighted.mean(Residential.instability.Scores,Dissemination.area..DA..Population),
ED = weighted.mean(Economic.dependency.Scores,Dissemination.area..DA..Population),
EC = weighted.mean(Ethno.cultural.composition.Scores,Dissemination.area..DA..Population),
SV = weighted.mean(Situational.vulnerability.Scores,Dissemination.area..DA..Population)
)
imd$ADAUID = as.numeric(imd$ADAUID)
cenpop = read.csv('D:/COVID_19/Data/census_subset.csv')
imd = left_join(imd,cenpop[,c('ADAUID','popDens')],)
imd$popDens = log(as.numeric(imd$popDens))
imd$urb = 'Urban'
imd$urb[imd$popDens < 6] = 'Rural'
nday = max(df_bl$jDay)
imdstat = c('RI','ED','EC','popDens')
mstat = c('bl_avg_h_RoG','bl_avg_TotalDur','bl_avg_d_shannon')
outdf_stat = data.frame(t = NULL,mstat=NULL,imd=NULL,cor=NULL,stringsAsFactors = F)
outdf_pval = data.frame(t = NULL,mstat=NULL,imd=NULL,pval=NULL,stringsAsFactors = F)
outdf_urb = data.frame(t = NULL,mstat=NULL,imd=NULL,cor=NULL,stringsAsFactors = F)
#outdf_pval = data.frame(t = 1:nday,stat='X',RoG=0,TOH=0,DIV=0,stringsAsFactors = F)
for (i in 1:nday){
temp_df = subset(df_bl,jDay == i)
temp_df = left_join(temp_df, imd, by='ADAUID')
for (s in imdstat){
for (m in mstat){
cr = cor.test(temp_df[,s],temp_df[,m])
outdf_stat = rbind(outdf_stat,c(t=i,mstat=m,imd=s,cor=cr$estimate))
outdf_pval = rbind(outdf_pval,c(t=i,mstat=m,imd=s,pval=cr$p.value))
cr2 = cor.test(temp_df[temp_df$urb=='Urban',s],
temp_df[temp_df$urb=='Urban',m])
outdf_urb = rbind(outdf_urb,c(t=i,mstat=m,imd=s,cor=cr2$estimate))
}
}
}
names(outdf_stat) = c('jDay','mstat','imd','cor')
outdf_stat$jDay = as.numeric(outdf_stat$jDay)
outdf_stat$cor = as.numeric(outdf_stat$cor)
names(outdf_pval) = c('jDay','mstat','imd','pval')
outdf_pval$jDay = as.numeric(outdf_pval$jDay)
outdf_pval$pval = as.numeric(outdf_pval$pval)
names(outdf_urb) = c('jDay','mstat','imd','cor')
outdf_urb$jDay = as.numeric(outdf_urb$jDay)
outdf_urb$cor = as.numeric(outdf_urb$cor)
# temp$Stat = factor(temp$Stat,levels=c('RoG','TOH','DIV'))
#
# ts1 = temp[temp$Stat=='RoG',]
# ts2 = temp[temp$Stat=='TOH',]
# ts3 = temp[temp$Stat=='DIV',]
# f7 = rep(1/7,7)
# ts1$fval = stats::filter(ts1$Value,f7,sides=2)
# ts2$fval = stats::filter(ts2$Value,f7,sides=2)
# ts3$fval = stats::filter(ts3$Value,f7,sides=2)
cor_plot = function(ts,imdvar,f=7){
ts = subset(ts,imd == imdvar)
ff = rep(1/f,f)
ts$fval = NA
for (i in unique(ts$mstat)){
ind = which(ts$mstat == i)
ts$fval[ind] = stats::filter(ts$cor[ind],ff,sides=2)
}
txtsz=3
days_vec = c(77, 104, 141, 164, 199, 223, 258, 291, 328, 361)
ts$mstat = factor(ts$mstat,levels=c('bl_avg_h_RoG','bl_avg_TotalDur','bl_avg_d_shannon'),labels=c('RoG','TOH','DIV'))
cor = ggplot() +
geom_line(data=ts,aes(x=jDay,y=cor,group=mstat),color='grey') +
geom_line(data=ts,aes(x=jDay,y=fval,colour=mstat)) +
scale_color_manual(values=c('blue','purple','black')) +
#ylim(-0.6,0.6)+
xlab('') +
ylab(paste0('r (',imdvar,')')) +
scale_x_continuous(breaks=c(1, 32, 61, 92, 122, 153, 183,214,245,275,306,336),
labels=c('Jan','Feb','Mar','Apr','May','Jun',
'Jul','Aug','Sep','Oct','Nov','Dec')) +
geom_vline(xintercept=days_vec[1]-0.5,col='red') +                  #Lockdown - Mar 17
geom_vline(xintercept=days_vec[3]-0.5,col='orange') +               #Stage 1 - May 20
geom_vline(xintercept=days_vec[4]-0.5,col='#DBA800',lty=1) +        #Stage 2 - Jun 12
geom_vline(xintercept=days_vec[5]-0.5,col='#005000',lty=1) +        #Stage 3 - Jul 17
geom_vline(xintercept=days_vec[8]-7.5,col='#DBA800',lty=1) +        #Stage 2 - Oct 10
geom_vline(xintercept=days_vec[9]-0.5,col='red',lty=2) +    #Toronto Lockdown - Nov23
geom_vline(xintercept=days_vec[10]-0.5,col='red',lty=1) +        #Lockdown - Dec 26
annotate('text',x=days_vec[1]-5,y=Inf,hjust=1.1,label='Lockdown - Mar 17',angle=90,color='red',size=txtsz)+
annotate('text',x=days_vec[3]-5,y=Inf,hjust=1.1,label='Stage 1 - May 20',angle=90,color='orange',size=txtsz)+
annotate('text',x=days_vec[4]-5,y=Inf,hjust=1.1,label='Stage 2 - Jun 12',angle=90,color='#DBA800',size=txtsz)+
annotate('text',x=days_vec[5]-5,y=Inf,hjust=1.1,label='Stage 3 - Jul 17',angle=90,color='#005000',size=txtsz)+
annotate('text',x=days_vec[8]-12,y=Inf,hjust=1.1,label='Stage 2* - Oct 10',angle=90,color='#DBA800',size=txtsz) +
annotate('text',x=days_vec[9]-5,y=Inf,hjust=1.1,label='Lockdown* -  Nov 23',angle=90,color='red',size=txtsz)+
annotate('text',x=days_vec[10]-5,y=Inf,hjust=1.1,label='Lockdown - Dec 26',angle=90,color='red',size=txtsz)+
geom_hline(yintercept=0.097,col='coral',lty=2) +
geom_hline(yintercept=-0.097,col='coral',lty=2) +
geom_hline(yintercept=0,col='grey80',lty=2) +
geom_hline(yintercept=-0.097,col='coral',lty=2) +
theme_light() +
theme(legend.position='none')
return(cor)
}
p1 = cor_plot(outdf_stat,'ED')
p2 = cor_plot(outdf_stat,'EC')
p3 = cor_plot(outdf_stat,'RI')
p4 = cor_plot(outdf_stat,'popDens')
p5 = cor_plot(outdf_urb,'EC')
p1 = p1 + ylab('r (Economic)')
p2 = p2 + ylab('r (Ethno-Cultural)')
p3 = p3 + ylab('r (Residential)')
p4 = p4 + ylab('r (Pop Dens)')
p5 = p5 + ylab('r (urban only Ethno-Cultural)')
p1 = p1 + labs(tag='a)')
p2 = p2 + labs(tag='b)')
p3 = p3 + labs(tag='c)')
p4 = p4 + labs(tag='d)')
p1 = p1 + theme(legend.position = c(0.82,0.15),
legend.title = element_blank(),
legend.box.background = element_rect(colour = "black"),
legend.direction='horizontal'
)
gg = grid.arrange(p1,p2,p3,p4,ncol=1)
ggsave(gg,filename='Fig 2 - Correlation Plot.png',width=8,height=10)
covid
devtools::install_github('jedalong/wildlifeDI')
### Cacheing data for speed
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(cache = TRUE)
library(wildlifeDI)
library(adehabitatLT)
library(ggplot2)
data(does)
does
plot(does)
plt <- dcPlot(does,tc=15*60,dmax=1000)
plt
doecons <- conProcess(does,dc=50,tc=15*60)
doecons <- conProcess(does,dc=50,tc=15*60)
doephas <- conPhase(doecons, pc=60*60)
conSummary(doephas)
doepair <- conPairs(doephas)
doetemp <- conTemporal(doephas,units='mins')
devtools::install_github('jedalong/wildlifeDI')
devtools::install_github('jedalong/wildlifeDI')
devtools::install_github('wildlifeDI')
devtools::install_github('jedalong/wildlifeDI')
### Cacheing data for speed
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(cache = TRUE)
hist(as.numeric(doetemp$duration)) #figure 2d
### Cacheing data for speed
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(cache = TRUE)
library(wildlifeDI)
library(adehabitatLT)
library(ggplot2)
data(does)
does
plot(does)
plt <- dcPlot(does,tc=15*60,dmax=1000)
plt
doecons <- conProcess(does,dc=50,tc=15*60)
doephas <- conPhase(doecons, pc=60*60)
conSummary(doephas)
doepair <- conPairs(doephas)
doetemp <- conTemporal(doephas,units='mins')
doepair$hod <- as.POSIXlt(doepair$date)$hour + as.POSIXlt(doepair$date)$min / 60  #convert POSIX to hours
doetemp$hod <- as.POSIXlt(doetemp$start_time)$hour + as.POSIXlt(doetemp$start_time)$min / 60  #convert POSIX to hours
doepair$dom <- as.POSIXlt(doepair$date)$mday
hist(doepair$dom,breaks=0:30)
hist(doepair$hod,breaks=0:24) #Figure 2b
hist(doetemp$hod,breaks=0:24) #Figure 2c
does
traj = does
tr1 <- ld(traj)
prj4string <- attr(traj,'proj4string')
spo = st_as_sf(dfs,coords=c('x','y'),crs=prj4string)
library(sf)
spo = st_as_sf(dfs,coords=c('x','y'),crs=prj4string)
spo = st_as_sf(tr1,coords=c('x','y'),crs=prj4string)
id = NULL #fix global variable issue in package
g = dplyr::group_by(spo,id)
spl = st_cast(g,"LINESTRING")
plot(spo['id'])
plot(spl['id'])
g = dplyr::group_by(spo,id)
s = dplyr::summarise(g,
traj_begin = min(date),
traj_end = max(date),
npt = dplyr::n(),
do_union=FALSE)
s2 = s[s$npt > 1,]
spl = st_cast(g,"LINESTRING")
plot(spl['id'])
spl = st_cast(s2,"LINESTRING")
plot(spl['id'])
devtools::install_github('jedalong/wildlifeDI')
setwd('D:/RPackages/wildlifeDI/wildlifeDI/')
### Cacheing data for speed
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(cache = TRUE)
library(wildlifeDI)
library(adehabitatLT)
library(ggplot2)
data(does)
does
plot(does)
plt <- dcPlot(does,tc=15*60,dmax=1000)
plt
doecons <- conProcess(does,dc=50,tc=15*60)
doephas <- conPhase(doecons, pc=60*60)
conSummary(doephas)
doepair <- conPairs(doephas)
doetemp <- conTemporal(doephas,units='mins')
doepair$hod <- as.POSIXlt(doepair$date)$hour + as.POSIXlt(doepair$date)$min / 60  #convert POSIX to hours
doetemp$hod <- as.POSIXlt(doetemp$start_time)$hour + as.POSIXlt(doetemp$start_time)$min / 60  #convert POSIX to hours
doepair$dom <- as.POSIXlt(doepair$date)$mday
hist(doepair$dom,breaks=0:30)
hist(doepair$hod,breaks=0:24) #Figure 2b
hist(doetemp$hod,breaks=0:24) #Figure 2c
hist(as.numeric(doetemp$duration)) #figure 2d
con_sf <- conSpatial(doephas,type='point')             # Get points of all contacts
plot(con_sf['contact_pha'])
#Figure 3a
sf_pt <- ltraj2sf(does)  # Turn all fixes into sf points
plot(sf_pt['id'])
plot(sf_pt['id'])
plot(con_sf,add=T)
plot(sf_pt['id'])
plot(con_sf['contact_pha'],add=T)
plot(st_geometry(sf_pt),col='grey',pch=20)
library(sf)
plot(st_geometry(sf_pt),col='grey',pch=20)
plot(st_gemetry(con_sf),col='balck',pch=20,add=T)
plot(st_geometry(con_sf),col='balck',pch=20,add=T)
plot(st_geometry(sf_pt),col='grey',pch=20)
plot(st_geometry(sf_pt),col='grey',pch=20)
plot(st_geometry(con_sf),col='balck',pch=20,add=T)
plot(st_geometry(sf_pt),col='grey',pch=20)
plot(st_geometry(con_sf),col='black',pch=20,add=T)
plot(st_geometry(sf_pt),col='grey',pch=20)
plot(st_geometry(con_sf),col='black',pch=20,add=T
plot(st_geometry(con_sf),col='black',pch=20,add=T)
plot(st_geometry(sf_pt),col='grey',pch=20)
plot(st_geometry(con_sf),col='black',pch=20,add=T)
con_sf <- conSpatial(doephas,type='point')             # Get points of all contacts
#Figure 3a
sf_pt <- ltraj2sf(does)  # Turn all fixes into sf points
plot(st_geometry(sf_pt),col='grey',pch=20)
plot(st_geometry(con_sf),col='black',pch=20,add=T)
#Figure 3b
con_sf_first <- conSpatial(doephas,type='point',def='first')
plot(st_geometry(sf_pt),col='grey',pch=20)
plot(st_geometry(con_sf),col='black',pch=20,add=T)
plot(st_geometry(con_sf_first),col='red',pch=20,add=T)
#Figure 3c
con_sf_ln <- conSpatial(doephas,type='line')
plot(st_geometry(sf_pt),col='grey',pch=20)
plot(st_geometry(con_sf_first),col='black',pch=20,add=T)
plot(st_geometry(con_sf_ln),col='red',add=T)
#Figure 3c
con_sf_ln <- conSpatial(doephas,type='line')
sf_ln <- ltraj2sf(does,type='line')  # Turn all fixes into sf points
plot(st_geometry(sf_ln),col='grey')
plot(st_geometry(con_sf_ln),col='red',add=T)
setwd('D:/RPackages/wildlifeDI/wildlifeDI/')
#test using devtools
devtools::check()
devtools::check_win_release()
?devtools::check_rhub
#Check Rhub
devtools::check_rhub()
_
doepair <- conPairs(doephas)
doetemp <- conTemporal(doephas,units='mins')
doepair$hod <- as.POSIXlt(doepair$date)$hour + as.POSIXlt(doepair$date)$min / 60  #convert POSIX to hours
doetemp$hod <- as.POSIXlt(doetemp$start_time)$hour + as.POSIXlt(doetemp$start_time)$min / 60  #convert POSIX to hours
doepair$dom <- as.POSIXlt(doepair$date)$mday
hist(doepair$dom,breaks=0:31)
#Check Rhub
devtools::check_rhub()
library(adehabitatLT)
library(ggplot2)
library(cowplot)
library(sf)
#data(does)
load('D:/RPackages/wildlifeDI/does.rdata')
data(does)
library(adehabitatLT)
library(ggplot2)
library(cowplot)
library(sf)
data(does)
#load('D:/RPackages/wildlifeDI/wildlifeDI/data/does.rdata')
doecons <- conProcess(does,dc=50,tc=15*60)
doephas <- conPhase(doecons, pc=60*60)
doepair <- conPairs(doephas)
doetemp <- conTemporal(doephas,units='mins')
doepair$hod <- as.POSIXlt(doepair$date)$hour + as.POSIXlt(doepair$date)$min / 60  #convert POSIX to hours
doetemp$hod <- as.POSIXlt(doetemp$start_time)$hour + as.POSIXlt(doetemp$start_time)$min / 60  #convert POSIX to hours
doepair$dom <- as.POSIXlt(doepair$date)$mday
data(mockhunt)
#load('D:/RPackages/wildlifeDI/mockhunt.rdata')
#head(mockhunt)
#Figure 2
#----------------
png('D:/Mobility/Noble_Deer/HuntDeer/Results/Figure2.png',height=7,width=7,units='in',res=300)
par(mfcol=c(4,1),mar=c(4,4,1,0))
hist(doepair$dom,breaks=0:30, main='',xlab='Day of Month',xlim=c(0,30))            #Figure 2a
mtext('a)',1,line=3,adj=0)
hist(doepair$hod,breaks=0:24, main='',xlab='Hour of Day',xlim=c(0,25))             #Figure 2b
mtext('b)',1,line=3,adj=0)
hist(doetemp$hod,breaks=0:24, main='',xlab='Hour of Day',xlim=c(0,25))             #Figure 2c
mtext('c)',1,line=3,adj=0)
hist(as.numeric(doetemp$duration),main='',xlab='Duration (hrs)')                   #figure 2d
mtext('d)',1,line=3,adj=0)
dev.off()
#----
#Figure 3
#----------------
con_sf <- conSpatial(doephas,type='point')                   # Get points of all contacts
con_sf_first <- conSpatial(doephas,type='point',def='first') # Get points of first fix of phase
con_sf_ln <- conSpatial(doephas,type='line')
sf_pt <- ltraj2sf(does)  # Turn all fixes into sf points
sf_ln <- ltraj2sf(does,type='line')  # Turn all fixes into sf line
png('D:/Mobility/Noble_Deer/HuntDeer/Results/Figure3.png',height=3,width=8,units='in',res=300)
par(mfcol=c(1,3),mar=c(2,1,1,0))
# panel a
plot(st_geometry(sf_pt),col='grey',pch=20,cex=0.5)
plot(st_geometry(con_sf),col='black',pch=20,cex=0.5,add=T)
mtext('a)',1,line=1,adj=0)
box()
# panel b
plot(st_geometry(sf_pt),col='grey',pch=20,cex=0.5)
plot(st_geometry(con_sf),col='black',pch=20,cex=0.5,add=T)
plot(st_geometry(con_sf_first),col='red',pch=20,cex=0.5,add=T)
mtext('b)',1,line=1,adj=0)
box()
# panel c
plot(st_geometry(sf_ln),col='grey')
plot(st_geometry(con_sf_ln),col='red',add=T)
mtext('c)',1,line=1,adj=0)
box()
dev.off()
#----
setwd('D:/RPackages/wildlifeDI/wildlifeDI/')
#Set up Travis CI for checking on linux automatically through github
usethis::use_github_actions()
#test using devtools
devtools::check()
devtools::check_win_release()
devtools::release_checks()
#test building on win-builder development version
devtools::check_win_devel()
#Testing building on Rhub (windows server and two Linux versions)
devtools::check_rhub()
install.packages('tibble')
install.packages("tibble")
