library(knitr)
?kable
kable(df)
kable(data(mtcars))
?boxplot
deer_sj = subset(deer_df,reserve = 'San Juan')
library(sf)
#individual summary data
load('D:/mobility/mexico_vhf/sjsv_reserve/deer_df.rdata')
deer_df = deer_df[order(deer_df$DeerID),]
deer_df[,c('DeerID','reserve','n','distance','mcp_area','kde_area','mean_d_fence')]
summary(deer_df)
deer_sj = subset(deer_df,reserve = 'San Juan')
deer_sv = subset(deer_df,reserve = 'San Vicente')
nsj = nrow(deer_sj)
nsv = nrow(deer_sv)
labs = c(paste0('San Juan (n = ',nsj,')'),paste0('San Vicente (n = ',nsj,')'))
boxplot(mcp_area~reserve,data=deer_df,ylab='MCP area (ha)',names=labs)
deer_sj = subset(deer_df,reserve == 'San Juan')
deer_sv = subset(deer_df,reserve == 'San Vicente')
nsj = nrow(deer_sj)
nsv = nrow(deer_sv)
labs = c(paste0('San Juan (n = ',nsj,')'),paste0('San Vicente (n = ',nsj,')'))
boxplot(mcp_area~reserve,data=deer_df,ylab='MCP area (ha)',names=labs)
deer_sj = subset(deer_df,reserve == 'San Juan')
deer_sv = subset(deer_df,reserve == 'San Vicente')
nsj = nrow(deer_sj)
nsv = nrow(deer_sv)
labs = c(paste0('San Juan (n = ',nsj,')'),paste0('San Vicente (n = ',nsv,')'))
boxplot(mcp_area~reserve,data=deer_df,ylab='MCP area (ha)',names=labs)
boxplot(kde_area~reserve,data=deer_df,ylab='MCP area (ha)',names=labs)
boxplot(kde_area~reserve,data=deer_df,ylab='KDE area (ha)',names=labs)
library(sf)
library(dplyr)
#individual summary data
load('D:/mobility/mexico_vhf/sjsv_reserve/deer_df.rdata')
deer_sj = subset(deer_df,reserve == 'San Juan')
deer_sv = subset(deer_df,reserve == 'San Vicente')
nsj = nrow(deer_sj)
nsv = nrow(deer_sv)
labs = c(paste0('San Juan (n = ',nsj,')'),paste0('San Vicente (n = ',nsv,')'))
boxplot(mcp_area~reserve,data=deer_df,ylab='MCP area (ha)',names=labs)
deer_df %>%
group_by(reserve) %>%
summarize(mean_MCP = mean(mcp_area),
sd_MCP = sd(mcp_area))
deer_sj = subset(deer_df,reserve == 'San Juan')
deer_sv = subset(deer_df,reserve == 'San Vicente')
nsj = nrow(deer_sj)
nsv = nrow(deer_sv)
labs = c(paste0('San Juan (n = ',nsj,')'),paste0('San Vicente (n = ',nsv,')'))
boxplot(mcp_area~reserve,data=deer_df,ylab='MCP area (ha)',names=labs)
deer_df %>%
group_by(reserve) %>%
summarize(mean_MCP = mean(mcp_area),
sd_MCP = sd(mcp_area),
n_MCP = nrow(),
se_MCP = sd(mcp_area)/sqrt(nrow()))
deer_sj = subset(deer_df,reserve == 'San Juan')
deer_sv = subset(deer_df,reserve == 'San Vicente')
nsj = nrow(deer_sj)
nsv = nrow(deer_sv)
labs = c(paste0('San Juan (n = ',nsj,')'),paste0('San Vicente (n = ',nsv,')'))
boxplot(mcp_area~reserve,data=deer_df,ylab='MCP area (ha)',names=labs)
deer_df %>%
group_by(reserve) %>%
summarize(mean_MCP = mean(mcp_area),
sd_MCP = sd(mcp_area),
n_MCP = nrow(mcp_area),
se_MCP = sd(mcp_area)/sqrt(nrow(mcp_area)))
deer_sj = subset(deer_df,reserve == 'San Juan')
deer_sv = subset(deer_df,reserve == 'San Vicente')
nsj = nrow(deer_sj)
nsv = nrow(deer_sv)
labs = c(paste0('San Juan (n = ',nsj,')'),paste0('San Vicente (n = ',nsv,')'))
boxplot(mcp_area~reserve,data=deer_df,ylab='MCP area (ha)',names=labs)
deer_df %>%
group_by(reserve) %>%
summarize(mean_MCP = mean(mcp_area),
sd_MCP = sd(mcp_area),
n_MCP = n(),
se_MCP = sd(mcp_area)/sqrt(n())
)
deer_sj = subset(deer_df,reserve == 'San Juan')
deer_sv = subset(deer_df,reserve == 'San Vicente')
nsj = nrow(deer_sj)
nsv = nrow(deer_sv)
labs = c(paste0('San Juan (n = ',nsj,')'),paste0('San Vicente (n = ',nsv,')'))
boxplot(mcp_area~reserve,data=deer_df,ylab='MCP area (ha)',names=labs)
deer_df %>%
group_by(reserve) %>%
summarize(mean_MCP = mean(mcp_area),
sd_MCP = sd(mcp_area),
se_MCP = sd(mcp_area)/sqrt(n()),
n_MCP = n()
)
deer_sj = subset(deer_df,reserve == 'San Juan')
deer_sv = subset(deer_df,reserve == 'San Vicente')
nsj = nrow(deer_sj)
nsv = nrow(deer_sv)
labs = c(paste0('San Juan (n = ',nsj,')'),paste0('San Vicente (n = ',nsv,')'))
boxplot(mcp_area~reserve,data=deer_df,ylab='MCP area (ha)',names=labs)
deer_df %>%
group_by(reserve) %>%
summarize(mean = mean(mcp_area),
sd = sd(mcp_area),
se = sd(mcp_area)/sqrt(n()),
n = n()
)
boxplot(kde_area~reserve,data=deer_df,ylab='KDE area (ha)',names=labs)
deer_df %>%
group_by(reserve) %>%
summarize(mean = mean(kde_area),
sd = sd(kde_area),
se = sd(kde_area)/sqrt(n()),
n = n()
)
#===================================================
# Script to Process Mexico VHF data
# San Juan Reserve and San Vicente Reserve
# By : Jed Long
# September, 2022
#==================================================
library(adehabitatHR)
library(adehabitatLT)
library(sf)
library(raster)
library(dplyr)
library(purrr)
# RUNZI PROCESSED THE DEER INTO AN RDATA FILE
load('D:/mobility/mexico_vhf/sjsv_reserve/deer_processed.rdata')
head(deer)
#LOAD IN SOME OTHER DATA
#Background Raster for KDE
ras = raster('D:/Mobility/Mexico_vhf/sjsv_reserve/sjsvras30.tif')
spix = as(ras,'SpatialPixels')
# Water and Feed Sites
sf_wf = st_read('D:/Mobility/Mexico_vhf/sjsv_reserve/SanJuan_SanVicente_Feeder_Water_Sites.shp')%>%
st_transform(st_crs(ras))
# San Juan Fence
sj_fen = st_read('D:/Mobility/Mexico_vhf/sjsv_reserve/SanJuan_Reserve_Boundary.shp') %>%
st_transform(st_crs(ras)) %>%
st_cast('LINESTRING')
# San Vicente Fence
sv_fen = st_read('D:/Mobility/Mexico_vhf/sjsv_reserve/SanVicente_Reserve_Boundary.shp') %>%
st_transform(st_crs(ras)) %>%
st_cast("LINESTRING")
#GO THROUGH EACH DEER AND PROCESS Home Ranges and Distance analysis
#rm(list=c('mexdeer'))
deer_df = data.frame(DeerID = 0, reserve=NA, n = 0, distance = 0, mcp_area = 0, kde_area = 0, kde_h = 0, mean_d_water = 0,
mean_d_feed = 0, mean_d_fence = 0, sd_d_water = 0, sd_d_feed = 0, sd_d_fence = 0, max_d_water = 0,
max_d_feed = 0, max_d_fence = 0, min_d_water = 0, min_d_feed = 0, min_d_fence = 0)
for (i in unique(deer$DeerID)){
dx_sf = subset(deer,DeerID == i)
dx_sf = dx_sf[,c('Name','DeerID','VHFID','Month','coords_x1','coords_x2','geometry')]
dx_sf = dx_sf[!duplicated(dx_sf),]
dx_sf = dx_sf[order(dx_sf$VHFID),]
dx_sf$VHFID_2 = 1:nrow(dx_sf) #Fake VHFID if there are weird duplicates?
dx_sp = as=as(dx_sf,"Spatial")
dx_df = data.frame(dx_sf)
dx_df = dx_df %>%
mutate(x = unlist(map(dx_df$geometry,1)),
y = unlist(map(dx_df$geometry,2)))
dx_df = subset(dx_df,select=-geometry)
dx_df$date = as.POSIXct(dx_df$VHFID_2,origin=Sys.time()) #fake date for computing distances
dx_tr = as.ltraj(dx_df[,c('x','y')],dx_df$date,id=i)
nfix = nrow(dx_sf)
#Distance
dist = sum(ld(dx_tr)$dist,na.rm=TRUE)
#MCP
mcp = mcp(dx_sp,percent=100,unin='m',unout='ha')
mcp_sf = st_as_sf(mcp)
mcp_area = st_area(mcp_sf)
file1 = paste0('D:/Mobility/mexico_vhf/sjsv_reserve/shapefiles/mcp_deer_',i,'.shp')
st_write(mcp_sf,file1,append=FALSE)
#KDE
h_ref = kernelUD(dx_sp,h='href',grid=spix)@h$h
kde = kernelUD(dx_sp,h=h_ref/2,grid=spix)
kde95 = getverticeshr(kde,95)
kde_sf = st_as_sf(kde95)
kde_area = st_area(kde_sf)
file2 = paste0('D:/Mobility/mexico_vhf/sjsv_reserve/shapefiles/kde_deer_',i,'.shp')
st_write(kde_sf,file2,append=FALSE)
#step length (add to points)
dx_sf$step_length = ld(dx_tr)$dist
#Distance to Water and Feed
if (i < 21){
reserve = 'San Vicente'
water = subset(sf_wf,Reserve == 'San Vicente' & Site == 'water')
feed = subset(sf_wf,Reserve == 'San Vicente' & Site == 'feed')
} else {
reserve = 'San Juan'
water = subset(sf_wf,Reserve == 'San Juan' & Site == 'water')
feed = subset(sf_wf,Reserve == 'San Juan' & Site == 'feed')
}
indw = st_nearest_feature(dx_sf,water)
dx_sf$dist_water = st_distance(dx_sf,water[indw,],by_element=TRUE)
indf = st_nearest_feature(dx_sf,feed)
dx_sf$dist_feed = st_distance(dx_sf,feed[indf,],by_element=TRUE)
#Distance to Fence
if (i < 21) {
dx_sf$dist_fence = st_distance(dx_sf,sv_fen,by_element=TRUE)
} else {
dx_sf$dist_fence = st_distance(dx_sf,sj_fen,by_element=TRUE)
}
#points
file3 = paste0('D:/Mobility/mexico_vhf/sjsv_reserve/shapefiles/points_deer_',i,'.shp')
st_write(dx_sf,file3,append=FALSE)
#lines
dx_lin = dx_sf %>% group_by(DeerID) %>% summarize(do_union=FALSE) %>% st_cast("LINESTRING")
file4 = paste0('D:/Mobility/mexico_vhf/sjsv_reserve/shapefiles/lines_deer_',i,'.shp')
st_write(dx_lin,file4,append=FALSE)
#Create super point shapefile
if (!exists('mexdeer')){mexdeer = dx_sf} else {mexdeer = rbind(mexdeer,dx_sf)}
#append statistics
rowstat = c(i,reserve, nfix, round(dist), mcp_area/10000, kde_area/10000, h_ref/2,
mean(dx_sf$dist_water), mean(dx_sf$dist_feed), mean(dx_sf$dist_fence),
sd(dx_sf$dist_water), sd(dx_sf$dist_feed), sd(dx_sf$dist_fence),
max(dx_sf$dist_water), max(dx_sf$dist_feed), max(dx_sf$dist_fence),
min(dx_sf$dist_water), min(dx_sf$dist_feed), min(dx_sf$dist_fence)
)
deer_df = rbind(deer_df, rowstat)
}
st_write(mexdeer,'D:/Mobility/mexico_vhf/sjsv_reserve/shapefiles/points_ALLDEER.shp',append=FALSE)
save(mexdeer,file='D:/Mobility/mexico_vhf/sjsv_reserve/mexdeer.RData')
# Fix up the summary table and save it
deer_df = deer_df[-1,]
cols.num <- names(deer_df)[c(1,3:19)]
deer_df[cols.num] <- sapply(deer_df[cols.num],as.numeric)
deer_df[,5:19] = round(deer_df[,5:19],1)
save(deer_df,file='D:/Mobility/mexico_vhf/sjsv_reserve/deer_df.RData')
# =========================================================
# Monthly Home Range Analysis
# =========================================================
deer_hr = data.frame(DeerID = 0, reserve=NA, Month = NA, n = 0, distance = 0, mcp_area = 0, mean_d_water = 0,
mean_d_feed = 0, mean_d_fence = 0, sd_d_water = 0, sd_d_feed = 0, sd_d_fence = 0, max_d_water = 0,
max_d_feed = 0, max_d_fence = 0, min_d_water = 0, min_d_feed = 0, min_d_fence = 0)
for (i in unique(deer$DeerID)){
dx_sfi = subset(deer,DeerID == i)
dx_sfi = dx_sfi[,c('Name','DeerID','VHFID','Month','coords_x1','coords_x2','geometry')]
dx_sfi = dx_sfi[!duplicated(dx_sfi),]
dx_sfi = dx_sfi[order(dx_sfi$VHFID),]
dx_sfi$VHFID_2 = 1:nrow(dx_sfi) #Fake VHFID if there are weird duplicates?
for (m in unique(dx_sfi$Month)){
dx_sf = subset(dx_sfi,Month == m)
dx_sp = as=as(dx_sf,"Spatial")
dx_df = data.frame(dx_sf)
dx_df = dx_df %>%
mutate(x = unlist(map(dx_df$geometry,1)),
y = unlist(map(dx_df$geometry,2)))
dx_df = subset(dx_df,select=-geometry)
dx_df$date = as.POSIXct(dx_df$VHFID_2,origin=Sys.time()) #fake date for computing distances
dx_tr = as.ltraj(dx_df[,c('x','y')],dx_df$date,id=i)
nfix = nrow(dx_sf)
#Distance
dist = sum(ld(dx_tr)$dist,na.rm=TRUE)
if (nfix > 5){
#MCP
mcp = mcp(dx_sp,percent=100,unin='m',unout='ha')
mcp_sf = st_as_sf(mcp)
mcp_area = st_area(mcp_sf)
#file1 = paste0('D:/Mobility/mexico_vhf/sjsv_reserve/shapefiles/mcp_deer_',i,'.shp')
#st_write(mcp_sf,file1,append=FALSE
} else {
mcp_area = NA
}
#Distance to Water and Feed
if (i < 21){
reserve = 'San Vicente'
water = subset(sf_wf,Reserve == 'San Vicente' & Site == 'water')
feed = subset(sf_wf,Reserve == 'San Vicente' & Site == 'feed')
} else {
reserve = 'San Juan'
water = subset(sf_wf,Reserve == 'San Juan' & Site == 'water')
feed = subset(sf_wf,Reserve == 'San Juan' & Site == 'feed')
}
indw = st_nearest_feature(dx_sf,water)
dx_sf$dist_water = st_distance(dx_sf,water[indw,],by_element=TRUE)
indf = st_nearest_feature(dx_sf,feed)
dx_sf$dist_feed = st_distance(dx_sf,feed[indf,],by_element=TRUE)
#Distance to Fence
if (i < 21) {
dx_sf$dist_fence = st_distance(dx_sf,sv_fen,by_element=TRUE)
} else {
dx_sf$dist_fence = st_distance(dx_sf,sj_fen,by_element=TRUE)
}
#append statistics
rowstat = c(i,reserve, m, nfix, round(dist), mcp_area/10000,
mean(dx_sf$dist_water), mean(dx_sf$dist_feed), mean(dx_sf$dist_fence),
sd(dx_sf$dist_water), sd(dx_sf$dist_feed), sd(dx_sf$dist_fence),
max(dx_sf$dist_water), max(dx_sf$dist_feed), max(dx_sf$dist_fence),
min(dx_sf$dist_water), min(dx_sf$dist_feed), min(dx_sf$dist_fence)
)
deer_hr = rbind(deer_hr, rowstat)
}
}
# Fix up the summary table and save it
deer_hr = deer_hr[-1,]
cols.num <- names(deer_hr)[c(1,4:18)]
deer_hr[cols.num] <- sapply(deer_hr[cols.num],as.numeric)
deer_hr[,6:18] = round(deer_hr[,6:18],1)
deer_hr$Month = factor(deer_hr$Month, levels = c('Marzo','Abril','Mayo','Junio','Julio','Agosto','Septiembre','Octubre'))
save(deer_hr,file='D:/Mobility/mexico_vhf/sjsv_reserve/deer_hr.RData')
boxplot(mcp_area~Month,deer_hr)
# Summarize the reserves
res_df = data.frame(reserve = c("San Juan","San Vicente"),area=0, n_feed = 0, n_water = 0)
?st_area
# Summarize the reserves
res_df = data.frame(reserve = c("San Juan","San Vicente"),area=0, n_feed = 0, n_water = 0)
res_df$area[1] = st_read('D:/Mobility/Mexico_vhf/sjsv_reserve/SanJuan_Reserve_Boundary.shp') %>% st_area()
res_df$n_feed = sf_wf %>%
subset(site=='feed') %>%
group_by(Reserve) %>%
summarize(n())
res_df$n_feed = sf_wf %>%
subset(Site=='feed') %>%
group_by(Reserve) %>%
summarize(n())
res_df
sf_wf %>%
subset(Site=='feed') %>%
group_by(Reserve) %>%
summarize(n())
(
# Summarize the reserves
res_df = data.frame(reserve = c("San Juan","San Vicente"),area=0, n_feed = 0, n_water = 0)
res_df$area[1] = st_read('D:/Mobility/Mexico_vhf/sjsv_reserve/SanJuan_Reserve_Boundary.shp') %>%
st_area()
res_df$area[2] = st_read('D:/Mobility/Mexico_vhf/sjsv_reserve/SanVicente_Reserve_Boundary.shp') %>%
st_area()
sf_wf %>%
subset(Site=='feed') %>%
group_by(Reserve) %>%
summarize(n = n())
sf_wf %>%
subset(Site=='feed') %>%
group_by(Reserve) %>%
summarize(n = n()) %>%
$n
# Summarize the reserves
res_df = data.frame(reserve = c("San Juan","San Vicente"),area=0, n_feed = 0, n_water = 0)
res_df$area[1] = st_read('D:/Mobility/Mexico_vhf/sjsv_reserve/SanJuan_Reserve_Boundary.shp') %>%
st_area()
res_df$area[2] = st_read('D:/Mobility/Mexico_vhf/sjsv_reserve/SanVicente_Reserve_Boundary.shp') %>%
st_area()
tabf = sf_wf %>%
subset(Site=='feed') %>%
group_by(Reserve) %>%
summarize(n = n())
res_df$n_feed = tabf$n
tabw = sf_wf %>%
subset(Site=='water') %>%
group_by(Reserve) %>%
summarize(n = n())
res_df$n_water = tabw$n
res_df$dens_feed = res_df$n_feed/res_df$area
res_df$dens_water = res_df$n_water/res_df$area
res_df
# Summarize the reserves
res_df = data.frame(reserve = c("San Juan","San Vicente"),area=0, n_feed = 0, n_water = 0)
res_df$area[1] = st_read('D:/Mobility/Mexico_vhf/sjsv_reserve/SanJuan_Reserve_Boundary.shp') %>%
st_area()/10000
res_df$area[2] = st_read('D:/Mobility/Mexico_vhf/sjsv_reserve/SanVicente_Reserve_Boundary.shp') %>%
st_area()/10000
tabf = sf_wf %>%
subset(Site=='feed') %>%
group_by(Reserve) %>%
summarize(n = n())
res_df$n_feed = tabf$n
tabw = sf_wf %>%
subset(Site=='water') %>%
group_by(Reserve) %>%
summarize(n = n())
res_df$n_water = tabw$n
res_df$dens_feed = res_df$n_feed/res_df$area
res_df$dens_water = res_df$n_water/res_df$area
res_df
st_read('D:/Mobility/Mexico_vhf/sjsv_reserve/SanJuan_Reserve_Boundary.shp') %>%
st_area()/10000
# Summarize the reserves
res_df = data.frame(reserve = c("San Juan","San Vicente"),area=0, n_feed = 0, n_water = 0)
res_df$area[1] = st_read('D:/Mobility/Mexico_vhf/sjsv_reserve/SanJuan_Reserve_Boundary.shp') %>%
st_area()/10000
res_df$area[2] = st_read('D:/Mobility/Mexico_vhf/sjsv_reserve/SanVicente_Reserve_Boundary.shp') %>%
st_area()/10000
tabf = sf_wf %>%
subset(Site=='feed') %>%
group_by(Reserve) %>%
summarize(n = n())
res_df$n_feed = tabf$n
tabw = sf_wf %>%
subset(Site=='water') %>%
group_by(Reserve) %>%
summarize(n = n())
res_df$n_water = tabw$n
res_df$dens_feed = res_df$n_feed/res_df$area /100
res_df$dens_water = res_df$n_water/res_df$area /100
save(res_df,file='D:/Mobility/mexico_vhf/sjsv_reserve/res_df.RData')
load('D:/mobility/mexico_vhf/sjsv_reserve/res_df.rdata')
res_df
# Summarize the reserves
res_df = data.frame(reserve = c("San Juan","San Vicente"),area=0, n_feed = 0, n_water = 0)
res_df$area[1] = st_read('D:/Mobility/Mexico_vhf/sjsv_reserve/SanJuan_Reserve_Boundary.shp') %>%
st_area()/10000
res_df$area[2] = st_read('D:/Mobility/Mexico_vhf/sjsv_reserve/SanVicente_Reserve_Boundary.shp') %>%
st_area()/10000
tabf = sf_wf %>%
subset(Site=='feed') %>%
group_by(Reserve) %>%
summarize(n = n())
res_df$n_feed = tabf$n
tabw = sf_wf %>%
subset(Site=='water') %>%
group_by(Reserve) %>%
summarize(n = n())
res_df$n_water = tabw$n
res_df$dens_feed = (res_df$n_feed/res_df$area) /100
res_df$dens_water = (res_df$n_water/res_df$area) /100
save(res_df,file='D:/Mobility/mexico_vhf/sjsv_reserve/res_df.RData')
load('D:/mobility/mexico_vhf/sjsv_reserve/res_df.rdata')
res_df
# Summarize the reserves
res_df = data.frame(reserve = c("San Juan","San Vicente"),area=0, n_feed = 0, n_water = 0)
res_df$area[1] = st_read('D:/Mobility/Mexico_vhf/sjsv_reserve/SanJuan_Reserve_Boundary.shp') %>%
st_area()/10000
res_df$area[2] = st_read('D:/Mobility/Mexico_vhf/sjsv_reserve/SanVicente_Reserve_Boundary.shp') %>%
st_area()/10000
tabf = sf_wf %>%
subset(Site=='feed') %>%
group_by(Reserve) %>%
summarize(n = n())
res_df$n_feed = tabf$n
tabw = sf_wf %>%
subset(Site=='water') %>%
group_by(Reserve) %>%
summarize(n = n())
res_df$n_water = tabw$n
res_df$dens_feed = (res_df$n_feed/res_df$area) *100
res_df$dens_water = (res_df$n_water/res_df$area) *100
save(res_df,file='D:/Mobility/mexico_vhf/sjsv_reserve/res_df.RData')
load('D:/mobility/mexico_vhf/sjsv_reserve/res_df.rdata')
res_df
View(deer_hr)
deer_hr
deer_hr[,1:6]
deer_hr[1:20,1:6]
